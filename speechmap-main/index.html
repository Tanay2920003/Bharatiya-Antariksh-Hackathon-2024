<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SpeechMap</title>
    <!-- Link to your local CSS file -->
    <link rel="stylesheet" href="files/leaflet.css" />
    <link rel="stylesheet" href="files/speechkitt.css" />
    <!-- Link to your local JS files -->
    <script src="files/annyang.min.js"></script>
    <script src="files/speechkitt.min.js"></script>
    <script src="files/jquery.min.js"></script>
    <script src="files/leaflet.js"></script>
</head>

<body>
<div id='map'></div>

<style>
#skitt-ui{
    z-index: 1000 !important;
}

#map{
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
}
</style>

<script>
if (annyang) {
  SpeechKITT.annyang();
  SpeechKITT.setStylesheet('files/speechkitt.css'); // Update path to local stylesheet
  SpeechKITT.setInstructionsText("Try 'Locate Berlin' or 'Zoom in'!");
  SpeechKITT.vroom();
}

var map = L.map("map").setView([50, 8], 5);
L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

const flyToCoords = function(city) {
    const inurl  = "https://nominatim.openstreetmap.org/search?q=" + city + "&limit=1&format=json&addressdetails=1";
    console.log(city);
    $.when(ajax1()).done(function(data){
        if (data.length > 0) {
            map.flyTo([data[0]["lat"], data[0]["lon"]], 12);
        } else {
            alert("City not found!");
        }
    }).fail(function() {
        alert("Error fetching data!");
    });

    function ajax1() {
        return $.ajax({
            url: inurl,
            dataType: "json"
        });
    }
};

const zoomMap = function(direction) {
  if (direction === 'in') {
    map.zoomIn();
  } else if (direction === 'out') {
    map.zoomOut();
  }
};

const stopListening = function() {
    annyang.abort();
};

if (annyang) {
  const commands = {
    'hello': () => { alert('Hey there, try some commands!'); },
    'locate *city': flyToCoords,
    'zoom *direction': zoomMap,
    'stop listening': stopListening
  };
  annyang.addCommands(commands);
  annyang.start();
}
</script>
</body>
</html>
